### The Blocker Mod - Events

namespace = tbm


### Variables

@volcanic_devastation = 20

### 1. Debug Event
planet_event = {
	id = tbm.1

	title = tbm_debug_title
	desc = tbm_debug_desc
	
	is_triggered_only = yes
	hide_window = yes

	# Debugged Code

	immediate = {
		log = "Debug Event is running."
	}
}

### 2. A Famous Mountain (Hanlder)
#	Disabled indefinitely as it relies on dynamic deposit text, which does not currently exist. If it ever does, this will be re-enabled.
# planet_event = {
# 	id = tbm.2

# 	hide_window = yes
# 	is_triggered_only = yes

# 	pre_triggers = {
# 		has_owner = yes
# 		is_homeworld = no
# 		is_ai = no
# 		original_owner = yes
# 		has_ground_combat = no
# 		is_occupied_flag = no
# 	}

# 	trigger = {
# 		any_owned_pop = {
# 			has_job = colonist
# 		}
# 		has_deposit = d_mountain_range
# 		NOR = {
# 			has_deposit = d_colonist_mountain
# 			has_deposit = d_homeworld_mountain
# 			has_deposit = d_ruler_mountain
# 		}
# 	}

# 	immediate = {
		
# 		# Get ruler name
# 		owner.leader = {
# 			save_global_event_target_as = ruler_at_the_time
# 		}
		
# 		# Get colonist's homeworld; this is technically redundant but helps with an edge case where Mt. Homeworld can get renamed if the planet changes ownership. Which is kind of weirdly appropriate but we're gonna fix it anyway.
# 		random_owned_pop = {
# 			limit = {
# 				has_job = colonist
# 			}
# 			species = {
# 				if = {
# 					limit = {
# 						exists = home_planet
# 					}
# 					home_planet = {
# 						save_global_event_target_as = colony_homeworld
# 					}
# 				}
# 				else = {
# 					# Avoids rare case where secondary species has no homeworld.
# 					owner.species.home_planet = {
# 						save_global_event_target_as = colony_homeworld
# 					}
# 				}
# 			}
# 		}

# 		# Expedition Lead
# 		owner = {
# 			create_leader = {
# 				class = envoy
# 				species = prevprev
# 			}
# 			last_created_leader = {
# 				save_global_event_target_as = colonist_name
# 				exile_leader_as = expedition_lead
# 			}
# 		}

# 		# Colonists' Special Friend, after whom they are of course going to name this mountain.
# 		if = {
# 			limit = {
# 				event_target:colonist_name = {
# 					gender = male
# 				}
# 			}
# 			owner = {
# 				create_leader = {
# 					class = envoy
# 					species = owner
# 					gender = female
# 				}
# 			}
# 		}
# 		else_if = {
# 			limit = {
# 				event_target:colonist_name = {
# 					gender = female
# 				}
# 			}
# 			owner = {
# 				create_leader = {
# 					class = envoy
# 					species = owner
# 					gender = male
# 				}
# 			}
# 		}
# 		else = {
# 			create_leader = {
# 				class = envoy
# 				species = prevprev
# 				gender = indeterminable
# 			}
# 		}
# 		last_created_leader = {
# 			save_global_event_target_as = colonist_friend
# 			exile_leader_as = colonist_special
# 		}

# 		planet_event = {
# 			id = tbm.3
# 			days = 1
# 		}
# 	}
# }

### 3. A Famous Mountain
# planet_event = {
# 	id = tbm.3
# 	title = tbm.3.name
# 	desc = tbm.3.desc
# 	picture = GFX_evt_gaia

# 	show_sound = event_finding_loot

# 	is_triggered_only = yes

# 	# Name after ruler
# 	option = {
# 		name = tbm.3.ruler
# 		trigger = {
# 			owner = {
# 				OR = {
# 					has_authority = auth_corporate
# 					has_authority = auth_oligarchic
# 					has_authority = auth_dictatorial
# 					has_authority = auth_imperial
# 				}
# 			}
# 		}

# 		remove_deposit = d_mountain_range
# 		add_deposit = d_ruler_mountain
# 	}

# 	# Name after homeworld
# 	option = {
# 		name = tbm.3.homeworld
# 		trigger = {
# 			owner = {
# 				OR = {
# 					has_authority = auth_democratic
# 					has_authority = auth_hive_mind
# 					has_authority = auth_machine_intelligence
# 				}
# 			}
# 		}
# 		remove_deposit = d_mountain_range
# 		add_deposit = d_homeworld_mountain
# 		last_added_deposit = {
# 			save_event_target_as = mountain_name
# 		}
# 	}

# 	# Name after colonists (random leader name)
# 	option = {
# 		name = tbm.3.expedition
# 		allow = {
# 			owner = {
# 				NOT = { has_authority = auth_imperial }
# 			}
# 		}

# 		remove_deposit = d_mountain_range
# 		add_deposit = d_colonist_mountain
# 	}

# 	after = {
# 		hidden_effect = {
# 			planet_event = {
# 				id = tbm.4
# 				days = 1800
# 				random = 600
# 			}

# 			random_deposit = {
# 				limit = {
# 					OR = {
# 						is_deposit_type = d_colonist_mountain
# 						is_deposit_type = d_homeworld_mountain
# 						is_deposit_type = d_ruler_mountain
# 					}
# 				}
# 				save_event_target_as = named_mountain
# 			}
# 		}
# 	}
# }

### 4. A Famous Mountain - A Question of Mineral Rights
# planet_event = {
# 	id = tbm.4
# 	title = tbm.4.name
# 	desc = tbm.4.desc
# 	picture = GFX_evt_gaia

# 	show_sound = event_finding_loot

# 	is_triggered_only = yes

# 	# Sell the mineral rights
# 	option = {
# 		name = tbm.4.sell
		
# 		random_deposit = {
# 			limit = {
# 				OR = {
# 					is_deposit_type = d_ruler_mountain
# 					is_deposit_type = d_homeworld_mountain
# 					is_deposit_type = d_colonist_mountain
# 				}
# 			}
# 			remove_deposit = yes
# 		}

# 		this = {
# 			add_deposit = d_mountain_range
# 		}

# 		add_modifier = {
# 			modifier = sold_famous_mountain
# 			days = 3600
# 		}
		
# 		random_deposit = {
# 			limit = {
# 				is_deposit_type = d_mountain_range
# 			}
# 			set_deposit_flag = mineral_rights
# 		}
# 	}

# 	# Have governor solve it
# 	option = {
# 		name = tbm.4.gov
# 		trigger = {
# 			is_sector_capital = yes
# 			planet = {
# 				exists = leader
# 			}
# 		}

# 		random_deposit = {
# 			limit = {
# 				OR = {
# 					is_deposit_type = d_ruler_mountain
# 					is_deposit_type = d_homeworld_mountain
# 					is_deposit_type = d_colonist_mountain
# 				}
# 			}
# 			set_deposit_flag = mineral_rights
# 		}

# 		owner = {
# 			add_resource = {
# 				unity = -200
# 			}
# 		}
# 	}

# 	# Protect famopus mountain
# 	option = {
# 		name = tbm.4.protect
# 		random_deposit = {
# 			limit = {
# 				OR = {
# 					is_deposit_type = d_ruler_mountain
# 					is_deposit_type = d_homeworld_mountain
# 					is_deposit_type = d_colonist_mountain
# 				}
# 			}
# 			set_deposit_flag = mining_prohibited
# 		}
# 		owner = {
# 			add_resource = {
# 				unity = 200
# 			}
# 		}
# 	}
# }


### 5. Dangerous Wildlife - Cull the Herd?
planet_event = {
	id = tbm.5
	title = tbm.5.name
    desc = tbm.5.desc
    picture = GFX_evt_scanning_remains
	show_sound = event_finding_loot

	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
		has_ground_combat = no
		is_occupied_flag = no
	}

	#No change
	option = {
		name = tbmker.5.a
	}
	
	#Hunt
	option = {
		name = tbm.5.b
		add_modifier = {
			modifier = dangerous_wildlife_permits
			days = -1
		}
		remove_deposit = d_dangerous_wildlife_blocker
	}

	#Poach
	option = {
		name = tbm.5.c
		add_modifier = {
			modifier = dangerous_wildlife_poachers
			days = -1
		}
		remove_deposit = d_dangerous_wildlife_blocker
		hidden_effect = {
			random_list = { 
				10 = {
					planet_event = {
						id = tbm.6
						days = 540
						random = 180
					}
				}
				90 = {}
			}
		}
	}

	#Remove
	option = {
		trigger = {
			owner = {
				has_technology = tech_dangerous_wildlife
			}
			num_districts = {
				type = district_farming
				value > 2
			}
		}
		name = tbm.5.d
		owner = {
			add_resource = {
				energy = -500
			}
		}
		add_modifier = {
			modifier = dangerous_wildlife_toxin
			days = 180
		}
		remove_deposit = d_dangerous_wildlife_blocker
		#Consequence triggers
		hidden_effect = {
			random_list = {
				10 = {
					planet_event = {
						id = tbm.6
						days = 540
						random = 180
					}
				}
				10 = {
					planet_event = {
						id = tbm.7
						days = 540
						random = 180
					}
				}
				20 = {
					planet_event = {
						id = tbm.8
						days = 540
						random = 180
					}
				}
				60 = {}
			}
		}
	}

	#Yummy
	option = {
		name = tbm.5.e
		trigger = {
			owner = {
				has_civic = civic_hive_devouring_swarm
			}
		}
		owner = { 
			add_resource = { 
				food = 200
			}
		}
	}
}

### 6. Dangerous Wildlife - Planetary Food System Collapses
planet_event = {
	id = tbm.6

	title = tbm.6.name
    desc = tbm.6.desc
    picture = GFX_evt_scanning_remains
	show_sound = event_finding_loot

	is_triggered_only = yes

	option = {
		name = tbm.6.a
		add_modifier = {
			modifier = dangerous_wildlife_food_changes
		}
	}

	#Option to genetically modify species with gene tailoring
	#Not built yet.
	option = {
		name = blocker.6.b
		allow = {
			owner = {
				has_technology = tech_gene_tailoring
			}
			planet = {
				has_building = building_clinic
			}
		}
		enable_special_project = {
			name = "PREDATOR_MODIFICATION_PROJECT"
		}
	}
}

### 7. Dangerous Wildlife - Toxin Seeps Into Water System
planet_event = {
	id = tbm.7

	title = tbm.7.name
    desc = tbm.7.desc
    picture = GFX_evt_scanning_remains
	show_sound = event_finding_loot

	is_triggered_only = yes

	option = {
		name = tbm.7.a
		add_modifier = {
			modifier = dangerous_wildlife_contamination
			days = 1800
		}
	}
}

### 8. Dangerous Wildlife - Enhanced Biodiversity
planet_event = {
	id = tbm.8

	title = tbm.8.name
    desc = tbm.8.desc
    picture = GFX_evt_scanning_remains
	show_sound = event_finding_loot

	is_triggered_only = yes

	option = {
		name = tbm.8.a
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		add_deposit = d_fertile_lands
	}
}

### 9. Dangerous Wildlife - Predator Modification Project
planet_event = {
	id = tbm.9

	title = tbm.8.name
    desc = tbm.8.desc
    picture = GFX_evt_scanning_remains
	show_sound = event_finding_loot

	is_triggered_only = yes

	#Well done, lads
	option = {
		name = tbm.9.a
		remove_modifier = dangerous_wildlife_food_changes
		add_deposit = d_fertile_lands
	}
}


### 11. Volcanic Eruption
planet_event = {
	id = tbm.11
	title = tbm.11.name
	desc = tbm.11.desc
	picture = GFX_evt_molten

	show_sound = event_finding_loot

	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
	}

	trigger = {
		has_deposit = d_active_volcano
	}

	immediate = {
		set_variable_to_random_value = { which = @volcanic_devastation min = 20 max = 80  }
		add_planet_devastation = @volcanic_devastation
		random_list = {
			20 = {
				random_deposit = {
					limit = {
						is_deposit_type = d_active_volcano
					}
					remove_deposit = yes
				}
				add_deposit = d_tempestous_mountain
			}
			20 = {
				random_deposit = {
					limit = {
						is_deposit_type = d_active_volcano
					}
					remove_deposit = yes
				}
				add_deposit = d_veiny_cliffs
			}
			59 = {
				random_deposit = {
					limit = {
						is_deposit_type = d_active_volcano
					}
					set_deposit_flag = volcano_erupted
				}
			}
			1 = {
				change_pc = pc_nuked
				planet_event = {
					id = tbm.13
					days = 1
				}
			}
		}
	}

	option = {
		name = tbm.11.a
	}
	option = {
		trigger = {
			owner = {
				OR = {
					has_authority = auth_democratic
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
				}
			}
			# Prevent country that somehow has negative unity income from being able to pull through (or receive negative reward)
			owner = {
				has_monthly_income = { resource = unity  value < 0 }
			}
		}
		name = tbm.11.b

		owner = {
			add_resource = {
				food = -500
				energy = -500
			}
			
			add_monthly_resource_mult = {
				resource = unity
				value = 24
			}
		}
	}
}

### 12. Volcanic Instability - Warning Signs
planet_event = {
	id = tbm.12
	title = tbm.12.name
	desc = tbm.12.desc
	picture = GFX_evt_molten

	show_sound = event_finding_loot

	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
	}

	trigger = {
		has_deposit = d_active_volcano
		owner = { has_technology = tech_volcano }
	}

	option = {
		name = tbm.12.a
		planet_event = {
			id = tbm.14
			days = 90
			random = 60
		}
	}
}

### 13. Volcanic Ash Chokes Atmosphere
planet_event = {
	id = tbm.13
	title = tbm.13.name
	desc = tbm.13.desc
	picture = GFX_evt_molten

	show_sound = event_finding_loot

	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
	}

	immediate = {
		owner = {
			add_tech_progress = {
				tech = tech_terrestrial_sculpting
				progress = 0.2
			}
		}
	}

	option = {
		name = OK
	}
}

### 14. Mitigated Volcanic Eruption
planet_event = {
	id = tbm.14
	title = tbm.13.name
	desc = tbm.13.desc
	picture = GFX_evt_molten

	show_sound = event_finding_loot

	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
	}

	immediate = {
		set_variable_to_random_value = { which = @volcanic_devastation min = 20 max = 80  }
		add_planet_devastation = @volcanic_devastation
		random_list = {
			20 = {
				random_deposit = {
					limit = {
						is_deposit_type = d_active_volcano
					}
					remove_deposit = yes
				}
				add_deposit = d_tempestous_mountain
			}
			20 = {
				random_deposit = {
					limit = {
						is_deposit_type = d_active_volcano
					}
					remove_deposit = yes
				}
				add_deposit = d_veiny_cliffs
			}
			60 = {
				random_deposit = {
					limit = {
						is_deposit_type = d_active_volcano
					}
					set_deposit_flag = volcano_erupted
				}
			}
		}
	}

	option = {
		name = tbm.11.a
	}
}

### 16. Xenofauna Attack (Handler)
planet_event = {
	id = tbm.16

	hide_window = yes
	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
		original_owner = yes
		is_occupied_flag = no
	}

	trigger = {
		NOR = {
			has_planet_flag = night_watches_xenofauna
			has_planet_flag = settlement_attacked
		}
		any_deposit = {
			tree_feature = yes
		}
	}

	immediate = {
		random_deposit = {
			limit = { tree_feature = yes }
			save_event_target_as = wildlife_lair
		}
		
		random_list = {
			20 = {
				planet_event = {
					id = tbm.17
					days = 120
					random = 60
				}
			}
			80 = {}
		}
	}
}

### 17. Xenofauna Attacks Settlement
planet_event = {
	id = tbm.17
	title = tbm.17.name
    desc = {
		exclusive_trigger = {
			has_planet_flag = settlement_attacked
		}
		text = tbm.17.desc_clearance
	}
	desc = tbm.17.desc_exists
	picture = GFX_evt_baol_ruins
	show_sound = event_dangerous_animals

	is_triggered_only = yes

	immediate = {
		random_owned_pop = {
			limit = { has_job = dangerous_wildlife_hunter }
			kill_pop = yes
		}
	}

	# Send in the military
	option = {
		trigger = {
			has_deposit = d_dangerous_wildlife_blocker
		}
		name = tbm.17.military
		#this = { save_event_target_as = wildlife_planet }
		enable_special_project = {
			name = EXTERMINATE_XENOFAUNA
		}
	}
	
	# Allocate Additional Security
	option = {
		trigger = {
			has_deposit = d_dangerous_wildlife_blocker
		}
		name = tbm.17.security
		add_modifier = {
			modifier = night_watches
			years = 10
		}
		set_timed_planet_flag = {
			flag = night_watches_xenofauna
			years = 10
		}
	}

	# Public Service Announcements
	option = {
		trigger = {
			has_deposit = d_dangerous_wildlife_blocker
		}
		name = tbm.17.announcements
		custom_tooltip = tbm.17.announcements.tooltip
	}

	option = {
		name = UNFORTUNATE
	}
}

### 19. Landslide
planet_event = {
	id = tbm.19
	title = tbm.19.name
	desc = tbm.19.desc
	picture = GFX_evt_relic_world_street
	show_sound = event_finding_loot

	is_triggered_only = yes
	fire_only_once = yes
	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		is_ai = no
	}

	option = {
		name = tbm.19.a
		add_planet_devastation = 20		
		random_owned_pop = {
			limit = {
				has_job = farmer
			}
			kill_pop = yes
		}
		# 40% chance to change feature that caused landslide (60% nothing else happens)
		random_list = {
			40 = {
				random_deposit = {
					limit = {
						OR = {
							is_deposit_type = d_veiny_cliffs
							is_deposit_type = d_prosperous_mesa
							is_deposit_type = d_tempestous_mountain
						}
					}
					if = {
						limit = {
							this = {
								is_deposit_type = d_tempestous_mountain
							}
							prev = {
								num_pops > 10
							}
						}
						remove_deposit = yes
						planet = {
							add_deposit = d_veiny_cliffs
							add_blocker = {
								type = d_rubble
								blocked_deposit = last_added_deposit
							}
						}
					}
					else = {
						remove_deposit = yes
						root = { add_deposit = d_collapsed_cliffs }
					}
				}
			}
			60 = {}
		}
	}

	option = {
		name = tbm.19.b
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
					has_authority = auth_democratic
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = 2
			}
		}
		# 40% chance to change feature that caused landslide (60% nothing else happens)
		random_list = {
			40 = {
				random_deposit = {
					limit = {
						OR = {
							is_deposit_type = d_veiny_cliffs
							is_deposit_type = d_prosperous_mesa
							is_deposit_type = d_tempestous_mountain
						}
					}
					if = {
						limit = {
							this = {
								is_deposit_type = d_tempestous_mountain
							}
							prev = {
								num_pops > 10
							}
						}
						remove_deposit = yes
						planet = {
							add_deposit = d_veiny_cliffs
							add_blocker = {
								type = d_rubble
								blocked_deposit = last_added_deposit
							}
						}
					}
					else = {
						root = { 
							remove_deposit = yes
							add_deposit = d_collapsed_cliffs
						}
					}
				}
			}
			60 = {}
		}
	}
}

### 21. Proposed Marina
#	on_district_complete
planet_event = {
	id = tbm.21
	title = tbm.21.name
	# Superyacht Version
	desc = {
		trigger = {
			has_ruling_class = yes
			owner = {
				NOR = {
					has_authority = auth_democratic
					has_civic = civic_environmentalist
					has_civic = civic_beacon_of_liberty
				}
			}
		}
		text = tbm.21.desc_superyacht
	}
	# Hippy Tree-hugger Version
	desc = {
		trigger = {
			owner = {
				OR = {
					has_authority = auth_democratic
					has_civic = civic_environmentalist
					has_civic = civic_beacon_of_liberty
				}
			}
			NOT = { has_ruling_class = yes }
		}
		text = tbm.21.desc_treehuggers
	}
	picture = GFX_evt_acquire_asset
	show_sound = event_finding_loot

	is_triggered_only = yes

	trigger = {
		NOT = { has_planet_flag = proposed_marina }	
		last_district_changed = district_city	# on_district_complete checks built
		
		# Must have a coastal city (long-term, should add check for coastal features + at least one district; for now, just lower req on ocean worlds)
		if = {
			limit = {
				is_planet_class = pc_ocean
			}
			num_districts = {
				type = district_city
				value > 0
			}
		}
		else = {
			num_districts = {
				type = district_city
				value > 2
			}
		}
	}

	immediate = {
		set_planet_flag = proposed_marina
	}

	# Approve
	option = {
		name = tbm.21.approve
		trigger = {
			has_ruling_class = yes
			owner = {
				NOR = {
					has_authority = auth_democratic
					has_civic = civic_environmentalist
					has_civic = civic_beacon_of_liberty
				}
			}
		}

		add_modifier = {
			modifier = recreational_investment
			years = 10
		}
		random_list = {
			67 = {
				custom_tooltip = tbm.21.possible_protests
				hidden_effect = {
					planet_event = { id = tbm.23 days = 60 }
				}
			}
			33 = {
				custom_tooltip = tbm.21.no_protests
			}
		}
	}

	# Deny
	option = {
		name = tbm.21.deny

		if = {
			limit = {
				owner = {
					OR = {
						has_authority = auth_democratic
						has_civic = civic_environmentalist
						has_civic = civic_beacon_of_liberty
					}
				}
				NOT = { has_ruling_class = yes }
			}
			owner = {
				add_monthly_resource_mult = {
					resource = unity
					value = 2
				}
			}
		}

		add_modifier = {
			modifier = denied_investment
			years = 20
		}
	}

	# Preserve Reef
	option = {
		name = tbm.21.preserve
		custom_tooltip = tbm.21.preserve.tooltip	# Important! Reefs can no longer be cleared.
		trigger = {
			owner = { has_civic = civic_environmentalist }
		}
		set_planet_flag = reef_eco_preserve
	}

	# Crack Down
	option = {
		name = tbm.21.crackdown
		allow = {
			NOR = {
				owner = { 
					has_civic = civic_environmentalist 
					has_civic = civic_beacon_of_liberty
				}
			}
		}
		exclusive_trigger = {
			owner = { has_civic = civic_police_state }
		}

		add_modifier = {
			modifier = recreational_investment
			years = 10
		}
		hidden_effect = {
			random_list = {
				67 = {
					custom_tooltip = tbm.21.possible_protests
					hidden_effect = {
						planet_event = { id = tbm.23 days = 60 }
					}
				}
				33 = {
					custom_tooltip = tbm.21.no_protests
				}
			}
		}
	}

	# Do Nothing
	option = {
		name = tbm.21.nothing
		set_planet_flag = reef_exploited
		random_list = {
			67 = {
				custom_tooltip = tbm.21.possible_protests
				planet_event = { id = tbm.23 days = 60 }
			}
			33 = {
				custom_tooltip = tbm.21.no_protests
			}
		}
	}
}

### 23. Proposed Marina - Mass Protests	
planet_event = {
	id = tbm.23

	title = tbm.23.name
	desc = tbm.23.desc	
	picture = GFX_evt_civil_action
	show_sound = event_finding_loot

	is_triggered_only = yes

	# Send in military
	option = {
		trigger = {
			any_owned_pop = {
				OR = {
					has_job = enforcer
					has_job = soldier
				}
			}
		}
		name = tbm.23.military

		add_modifier = {
			modifier = denied_investment
			years = 20
		}
		add_modifier = {
			modifier = mass_protest
			days = 360
		}
		random_list = {
			30 = {
				custom_tooltip = tbm.23.casualties.random_tooltip
				random_owned_pop = {
					limit = { 
						OR = {
							has_job = enforcer
							has_job = soldier
						}
					}
					kill_pop = yes
				}
			}
			70 = {
				custom_tooltip = tbm.23.nothing.random_tooltip
			}
		}
	}

	# Hold Governor Accountable
	option = {
		allow = {
			NOT = {
				owner = {
					has_authority = auth_democratic
				}
			}
		}
		trigger = {
			planet = {		
				exists = leader
			}
		}
		name = tbm.23.governor
		custom_tooltip = tbm.22.preserve.tooltip # Important: Teeming Reefs can no longer be cleared

		owner = {
			add_modifier = {
				modifier = denied_investment
				years = 20
			}
		}
		kill_leader = {
			fire = yes
		}
		set_planet_flag = reef_eco_preserve
	}

	# Address Concerns
	option = {
		name = tbm.23.address
		custom_tooltip = tbm.22.preserve.tooltip
		allow = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_egalitarian
					has_civic = civic_environmentalist
				}
			}
		}

		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = 12
			}
		}
		set_planet_flag = reef_eco_preserve
	}

	# Clear the Reef
	option = {
		trigger = {
			NOT = {
				owner = { has_civic = civic_environmentalist }
			}
		}
		name = tbm.23.bulldoze
		custom_tooltip = tbm.23.bulldoze_tooltip

		add_modifier = {
			modifier = mass_protest
			years = 2
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = 6
			}
			add_resource = {
				food = 500
			}
		}
	}

	# Let Governor handle it
	option = {
		trigger = {
			planet = {		
				exists = leader
			}
		}
		name = tbm.23.leave

		add_modifier = {
			modifier = mass_protest
			years = 2
		}
	}

	# Fallback Option
	option = {
		name = tbm.23.terrible		#That's terrible....
		custom_tooltip = tbm.23.protests.tooltip
		add_modifier = {
			modifier = mass_protest
			years = 5
		}
	}
}

### 27. Flooding - Evacuations
planet_event = {
	id = tbm.27
	title = tbm.27.name
	desc = tbm.27.desc
	picture = GFX_evt_collapsing_roof
	show_sound = aqu_dragon_attack_mouth_deluge

	is_triggered_only = yes

	immediate = {
		add_modifier = {
			modifier = recent_flooding
			days = 360
		}
		add_modifier = {
			modifier = evacuations
			days = 180
		}
	}

	option = {
		name = tbm.27.confirm
	}
}

### 28. Flooding - Damage
planet_event = {
	id = tbm.28
	title = tbm.28.name
	desc = tbm.28.desc
	picture = GFX_evt_collapsing_roof
	show_sound = aqu_dragon_attack_mouth_deluge

	is_triggered_only = yes

	immediate = {
		add_modifier = {
			modifier = recent_flooding
			days = 360
		}
		remove_last_built_district = yes
	}

	option = {
		name = tbm.27.confirm
	}
}

### 29. Flooding - Destruction
planet_event = {
	id = tbm.29
	title = tbm.29.name
	desc = tbm.29.desc
	picture = GFX_evt_collapsing_roof
	show_sound = aqu_dragon_attack_mouth_deluge

	is_triggered_only = yes

	immediate = {
		add_modifier = {
			modifier = recent_flooding
			days = 360
		}
		add_planet_devastation = 30
	}

	option = {
		name = tbm.27.confirm
	}
}

### 30. Climate Control Network Malfunctions (lite)
planet_event = {
	id = tbm.30
	title = tbm.30.name
	desc = tbm.30.desc
	picture = GFX_evt_ocean
	show_sound = event_administrative_work

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
	}

	trigger = {
		NOT = { owner = { has_ascension_perk = ap_mastery_of_nature	}}
	}

	immediate = {
		random_list = {
			50 = {
				hidden_effect = {
					random_list = {
						33 = {
							add_modifier = {
								modifier = recent_flooding
								days = 360
							}
							add_modifier = {
								modifier = evacuations
								days = 180
							}
						}
						33 = {
							add_modifier = {
								modifier = recent_flooding
								days = 360
							}
							remove_last_built_district = yes
						}
						33 = {
							add_modifier = {
								modifier = recent_flooding
								days = 360
							}
							add_planet_devastation = 30
						}
					}
				}
				
			}
			50 = {
				modifier = {
					factor = 2
					owner = {
						has_technology = tech_terrestrial_sculpting
					}
				}
				modifier = {
					factor = 2
					owner = {
						has_technology = tech_ecological_adaptation
					}
				}
			}
		}
	}

	option = {
		name = OK
	}
}