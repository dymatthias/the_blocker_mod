### The Blocker Mod - Custom Features

# Spawning Variables

@high = 16
@med = 8
@low = 4
@very_low = 2	# Added by TBM to help with some spawning
@none = 0.01	# Needs small amount of weight or will cause problems.

@high_rare = 0.5
@mid_rare = 0.25
@low_rare = 0.1

@planet_type_bonus = 1.5

@blocker_high = 10
@blocker_low = 5

# ai_weight variables
# Vanilla defaults to weight = 1 - TBM weights differently for different features and different personalities, colony designations, and some other factors.

@base = 1	# Base ai_weight. AI will clear any feature at weight = 1 when it needs district space
@clear = 2	# AI will clear this feature immediately.
@keep = 0	# AI will keep this feature until it needs a district and no other features remain
@always_clear = 100	# AI will always clear this feature; used mainly for negative features (e.g., rubble)
@always_keep = -100 # AI will always keep this feature; used mainly for bonus features and some flavor features



### TBM Custom Features - Natural (these can spawn)

d_fjordland = {
	icon = d_fjordland
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	prerequisites = { "tech_terrestrial_sculpting"	}

	time = 1200

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 2500
		}
	}

	planet_modifier = {
		planet_max_districts_add = -3
		district_mining_max = 1
		planet_amenities_mult = 0.05
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 1000
			}
		}
	}

	drop_weight = {
		weight = @very_low

		modifier = {
			factor = 2
			planet_size < 15
			NOT = {
				is_moon = yes
			}
		}

		modifier = {
			factor = 4
			OR = {
				is_planet_class = pc_alpine
				is_planet_class = pc_tundra
				is_planet_class = pc_arctic
				is_planet_class = pc_gaia	
			}		
		}
		modifier = {
			factor = 1.5
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_ocean
			}
		}
		modifier = {
			factor = 0
			OR = {
				is_dry = yes
				is_planet_class = pc_tropical
			}
		}

		modifier = {
			factor = 2
			has_planet_modifier = pm_low_gravity
		}

		modifier = {
			factor = 2
			has_planet_modifier = pm_mineral_rich
		}
		modifier = {
			factor = 0.5
			OR = {
				has_planet_modifier = pm_mineral_poor
				has_planet_modifier = pm_asteroid_impacts
			}
		}
		modifier = {
			factor = 0
			has_planet_modifier = pm_high_gravity
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = 0.5
			OR = {
				colony_type = col_mining
			}
		}
		modifier = {
			add = -0.25
			owner = { has_ai_personality = hegemonic_imperialists } # We like imposing scenery.
		}
		modifier = {
			add = -0.25
			owner = { 
				OR = {
					has_ai_personality = erudite_explorers # Landmarks
				}
			}
		}
	}
}

d_mire = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 360

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 600
		}
	}
	
	planet_modifier = {
		planet_max_districts_add = -1
		planet_jobs_food_produces_mult = 0.05
		pop_amenities_usage_mult = 0.1
	}

	drop_weight = {
		weight = @blocker_low

		modifier = {
			factor = 4
			planet_size > 20
		}
		modifier = {
			factor = 2
			planet_size > 15
		}
		modifier = {
			factor = 0.5
			planet_size < 13
		}

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_tundra
				is_planet_class = pc_alpine
				is_planet_class = pc_continental
				is_planet_class = pc_ocean
				is_planet_class = pc_tropical
			}
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_savannah
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_desert
				is_planet_class = pc_arctic
				is_planet_class = pc_gaia
			}
		}

		modifier = {
			factor = 2
			OR = {
				has_deposit = d_highlands
				has_deposit = d_steppe_uplands
				has_deposit = d_boggy_fens
				has_deposit = d_dense_jungle
				has_deposit = d_taiga
				has_deposit = d_rugged_woods
			}
		}

		modifier = {
			factor = 2
			is_planet_class = pc_nuked
		}
	}

	ai_weight = {
		weight = @clear
	}
}

d_sandstone_spires = {
	category = deposit_cat_minerals_rare

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 450

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 1000
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		planet_jobs_minerals_produces_mult = 0.05
		planet_amenities_mult = 0.1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		planet_colonist_minerals_produces_add = 1
		planet_colonist_engineering_research_produces_add = 4
	}

	on_cleared = {
		#Jawas go here
		owner = {
			add_resource = {
				minerals = 1000
			}
		}
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 2
			is_dry = yes
		}

		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_tropical
				is_planet_class = pc_arctic
			}
		}

		modifier = {
			factor = 2
			has_planet_modifier = pm_low_gravity
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = 0.5	# AI always adds 1 in this case, but this feature doesn't provide resource districts and isn't great for resources.
			free_district_slots < 1
			OR = {
				colony_type = col_mining
				colony_type = col_rural
			}
		}
	}
}

d_natural_gardens = {
	category = deposit_cat_food_rare

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes
	
	should_swap_deposit_on_terraforming = no

	planet_modifier = {
		planet_jobs_food_produces_mult = 0.05
		planet_amenities_mult = 0.1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_food_produces_add = 4
			planet_colonist_unity_produces_add = 2
		}
	}

	potential = { is_planet_class = pc_gaia }

	drop_weight = {
		weight = @med
	}

	ai_weight = {
		weight = @keep

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights
	}
}

d_steppe_uplands = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 2200

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 1500
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		district_mining_max = 1
		district_generator_max = 1
		planet_jobs_productive_produces_mult = 0.05
	}

	prerequisites = { "tech_terrestrial_sculpting" }

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 1000
			}
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_savannah
				is_planet_class = pc_arid
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_arctic
				is_planet_class = pc_tropical
			}
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_ocean
				is_planet_class = pc_desert
				is_planet_class = pc_nuked
			}
		}

		modifier = {
			factor = 2
			has_deposit = d_mineral_fields
		}
		modifier = {
			factor = 2
			has_deposit = d_dangerous_wildlife_blocker
		}
	}

	ai_weight = {
		weight = @keep

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights
	}
}

d_glacier_lake = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	prerequisites = {
		"tech_terrestrial_sculpting"
	}

	time = 480

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 1500
			minerals = 250
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		district_farming_max = 1
		planet_amenities_add = 5
	}

	triggered_planet_modifier = {
		potential = { 
			exists = owner
			owner = { has_civic = civic_anglers }
		}
		modifier = {
			planet_farmers_food_produces_mult = 0.1		# This is slightly easier than adding _produces modifiers to anglers, mainly for compatibility reasons. In effect, you can catch fish here.
		}
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 2
			is_cold = yes
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_ocean
		}
		modifier = {
			factor = 0
			OR = {
				is_dry = yes
				is_planet_class = pc_tropical
			}
		}

		modifier = {
			factor = 4
			has_deposit = d_massive_glacier
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.5
			OR = {
				colony_type = col_farming
				free_amenities < 5
			}
		}
	}
}

d_giant_tree  = {
	icon = d_huge_tree
	category = deposit_cat_food
	
	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 360

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 300
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		planet_jobs_food_produces_mult = 0.1
		planet_jobs_minerals_produces_mult = 0.1
		planet_amenities_mult = 0.1	
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 4
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 1000
			}
		}
	}

	drop_weight = {
		weight = @very_low

		modifier = {
			factor = 4
			is_planet_class = pc_gaia
		}

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_tropical
				is_planet_class = pc_savannah
			}
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_alpine
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_ocean
				is_planet_class = pc_arid
				is_planet_class = pc_desert
				is_planet_class = pc_arctic
				is_planet_class = pc_tundra
			}
		}

		modifier = {
			factor = 2
			has_deposit = d_lush_jungle
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.75	# Amenities on resource worlds are good!
			OR = {
				colony_type = col_mining
				colony_type = col_farming
				colony_type = col_rural
			}
		}

		modifier = {
			add = -1
			owner = {
				OR = {
					has_ai_personality = erudite_explorers	#Science!
					has_ai_personality = harmonious_hierarchy
					has_ai_personality = federation_builders	#Respecting life
					has_ai_personality = migrating_flock	#Nest-building to do
					has_ai_personality = peaceful_traders
				}
			}
		}

		modifier = {
			add = 0.75
			owner = {
				OR = {
					has_ai_personality = ruthless_capitalists	#Is there profit in this?
					has_ai_personality = hegemonic_imperialists	# We like landmarks, but we also really like burning things.
				}
			}
		}

		modifier = {
			add = -1000
			owner = {
				is_hive_empire = yes
			}
		}
	}
}

d_sea_monster = {
	icon = d_landed_dragon
	category = deposit_cat_gaia

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	planet_modifier = {
		planet_jobs_food_produces_mult = 0.05
		trade_value_mult = -0.05
		planet_researchers_society_research_produces_mult = 0.15
	}

	triggered_planet_modifier = {
		potential = {
			owner = { has_trait = trait_aquatic	}
		}
		modifier = {
			planet_max_districts_add = -3
		}
	}

	triggered_planet_modifier = {
		potential = {
			owner = { has_civic = civic_anglers }
		}
		modifier = {
			planet_farmers_food_produces_mult = -0.2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		planet_colonist_society_research_produces_add = 2
	}

	potential = {
		OR = {
			is_planet_class = pc_ocean
			is_planet_class = pc_continental
			is_planet_class = pc_arctic
			is_planet_class = pc_gaia
			#is_planet_class = pc_pdaquatic
		}
	}

	drop_weight = {
		weight = @blocker_low

		modifier = {
			factor = 0.1
			OR = {
				is_planet_class = pc_continental
				#is_planet_class = pc_gaia
			}
		}
	}
}

d_great_lake = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 480

	prerequisites = {
		"tech_terrestrial_sculpting"
	}

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 600
			minerals = 1800
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		planet_amenities_add = 5
		planet_housing_mult = 0.2
		planet_farmers_food_produces_mult = 0.1
	}
	
	triggered_planet_modifier = {
		potential = { 
			owner = { 
				has_civic = civic_anglers 
			}
		}
		modifier = {
			planet_farmers_food_produces_mult = 0.15		# This is slightly easier than adding _produces modifiers to anglers, mainly for compatibility reasons. In effect, you can catch fish here.
		}
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 2
			is_wet = yes
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_tundra
				is_planet_class = pc_alpine
				is_planet_class = pc_savannah
			}
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_desert
				is_planet_class = pc_arid
				is_planet_class = pc_arctic
				is_planet_class = pc_ocean
			}
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.25
			always = yes
		}

		modifier = {
			add = -1
			colony_type = col_farming
		}

		modifier = {
			add = 0.5	# King of counter-intuitive, but AI will have lots of housing and amenities on urban worlds already.
			colony_type = col_city
		}

		modifier = {
			add = -5
			owner = { has_civic = civic_anglers }
		}

		modifier = {
			add = 0.5
			owner = {
				has_ai_personality = hegemonic_imperialists	# Gotta build on that lakefront property
			}
		}
	}
}

d_floodplains = {
	icon = d_natural_farmland
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 360

	resources = {
		category = deposit_blockers
		cost = {
			energy = 500
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
	}

	potential = {
		OR = {
			is_planet_class = pc_savannah
			is_planet_class = pc_desert
			is_planet_class = pc_continental
			is_planet_class = pc_alpine
			is_planet_class = pc_tundra
			is_planet_class = pc_gaia
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_savannah
				is_planet_class = pc_continental
				is_planet_class = pc_desert
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_alpine
				is_planet_class = pc_tundra
			}
		}

		modifier = {
			factor = 2
			has_deposit = d_great_river
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1.1	# Basically clear these unless it's a big farm world.
			colony_type = col_farming
		}

		modifier = {
			add = 0.1	# Unless we need a district AND we have other farming slots available, because these aren't that good and we might need housing, etc.
			num_free_districts = {
				type = district_farming
				value > 0
			}
		}

		modifier = {
			add = -0.75	# Keep these for Ag. Idyll as they get housing via farms.
			owner = { has_civic = civic_agrarian_idyll }
		}
	}
}

d_tidal_marshes = {
	icon = d_natural_farmland
	category = deposit_cat_food
	
	is_for_colonizable = yes
	use_weights_for_blocker_swap_types = no

	blocker_swap_types = {
	 	d_dyke
	}

	should_swap_deposit_on_terraforming = no

	time = 360
	
	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 500
			minerals = 200
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
		district_generator_max = 1
		pop_happiness = -0.05
	}

	potential = {
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_ocean
			is_planet_class = pc_gaia
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			has_deposit = d_fertile_delta
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1.1	# Basically clear these unless it's a big farm or wind world.
			OR = {
				colony_type = col_farming
				colony_type = col_generator
			}
		}

		modifier = {
			add = 0.1	# Unless we need a district AND we have other farming slots available, because these aren't that good and we might need housing, etc.
			OR = {
				num_free_districts = {
					type = district_farming
					value > 0
				}
				num_free_districts = {
					type = district_generator
					value > 0
				}
			}
		}

		modifier = {
			add = -0.75	# Keep these for Ag. Idyll as they get housing via farms.
			owner = { has_civic = civic_agrarian_idyll }
		}

		modifier = {
			add = -0.75	# Gestalts don't mind happiness hit
			owner = {
				is_gestalt = yes
			}
		}
	}
}

# Diabled until Phase 2
# d_sheltered_bay = {
		
# 	is_for_colonizable = yes
# 	should_swap_deposit_on_terraforming = yes
# 	category = deposit_category_gaia

# 	use_for_min_max_adjustments = yes

# 	planet_modifier = {
# 		planet_max_districts_add = 1
# 		district_farming_max = 1
# 		planet_amenities_mult = 0.05
# 	}

# 	drop_weight = {
# 		weight = @blocker_low

# 		modifier = {
# 			factor = 2
# 			OR = {
# 				is_planet_class = pc_continental
# 				is_planet_class = pc_gaia
# 				is_planet_class = pc_ocean
# 			}
# 		}
# 		modifier = {
# 			factor = 0.5
# 			OR = {
# 				is_planet_class = pc_tropical
# 				is_planet_class = pc_alpine
# 				is_planet_class = pc_tundra
# 				is_planet_class = pc_nuked
# 			}
# 		}
# 		modifier = {
# 			factor = 0
# 			is_dry = yes
# 		}
# 	}
# }

d_basaltic_outcrops = {
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 360

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 800
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_mining_max = 1
		planet_metallurgists_minerals_upkeep_add = -1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 1
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 2
			is_cold = yes
		}
		modifier = {
			factor = 0
			is_planet_class = pc_tropical
		}

		modifier = {
			factor = 2
			OR = {
				has_deposit = d_active_volcano
				has_deposit = d_volcanic_island	
			}
		}
		modifier = {
			factor = 2
			has_planet_modifier = pm_unstable_tectonics
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.75		# Metallurgist upkeep reduction
			colony_type = col_foundry
		}

		modifier = {
			add = -0.5
			colony_type = col_mining
		}

		modifier = {
			add = -0.5	# Especially keep these on foundry worlds that have miners as well
			colony_type = col_foundry
			num_assigned_jobs = {
				job = miner
				value > 2
			}
		}

		modifier = {
			add = -0.25
			owner = {
				has_ai_personality = ruthless_capitalists	# Alloys are profitable!
				has_ai_personality = hegemonic_imperialists	# We like imposing landscape (and mining)
				has_civic = civic_mining_guilds
				has_civic = civic_crafters
				has_civic = civic_corporate_crafters
				has_civic = civic_shared_burden
				has_origin = origin_subterranean
			}
		}
	}
}

d_volcanic_island = {
	icon = d_ocean
	category = deposit_cat_energy

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 1200

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 2000
		}
	}

	prerequisites = {
		"tech_volcano"
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1	# This is cancelled out if Aquatic
		planet_technician_energy_produces_mult = 0.05
		planet_jobs_food_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			is_planet_class = pc_ocean
		}
		modifier = {
			planet_max_districts_add = -1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_trait = trait_aquatic }
		}
		modifier = {
			planet_max_districts_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 2
		}
	}

	potential = {
		is_wet = yes
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			is_planet_class = pc_ocean
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -5
			owner = { has_trait = trait_aquatic }
			NOT = { is_planet_class = pc_ocean }
		}
	}
}

d_volcanic_soil = {
	icon = d_black_soil
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 90

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 400
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
		planet_farmers_food_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 2
		}
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 5
			OR = {
				has_deposit = d_active_volcano
				has_deposit = d_volcanic_island
			}
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -1
			colony_type = col_farming
		}

		modifier = {
			add = -0.75
			owner = {
				OR = {
					has_ai_personality = spiritual_seekers	# Preach, farmer
					has_ai_personality = evangelising_zealots
					has_ai_personality = peaceful_traders	# Easy pickings
					has_ai_personality = decadent_hierarchy
					has_ai_personality = harmonious_hierarchy
					has_ai_personality = xenophobic_isolationists
					has_ai_personality = fanatic_befrienders
					has_ai_personality = fanatic_purifiers
				}
			}
		}

		modifier = {
			add = -1000
			owner = { has_civic = civic_agrarian_idyll }
		}
	}
}

d_volcanic_ash = {
	icon = d_rubble
	category = deposit_cat_blockers

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 360

	resources = {
		category = deposit_blockers
		cost = {
			energy = 500
		}
	}
	
	planet_modifier = {
		planet_max_districts_add = -1
		planet_amenities_mult = -0.15
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_physics_research_produces_add = 2
		}
	}

	drop_weight = {
		weight = @none

		modifier = {
			add = 66
			OR = {
				has_deposit = d_volcanic_island
				has_deposit = d_active_volcano
			}
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = 100	# Always clear when we don't have colonists
			num_assigned_jobs = {
				job = colonist
				value < 1
			}
			NOT = { colony_type = col_default }	# To help avoid situations where colonists get promoted but the colony is still very new
		}
	}
}

d_fish_shoals = {
	icon = d_ocean
	category = deposit_cat_food
	
	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 180

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 200
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				food = 500
			}
		}
	}

	planet_modifier = {
		planet_jobs_food_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_food_produces_add = 2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_civic = civic_anglers	}
		}
		modifier = {
			district_farming_max = 1
			planet_jobs_food_produces_mult = 0.05
		}
	}

	potential = {
		OR = {
			is_wet = yes
			is_planet_class = pc_gaia
			is_planet_class = pc_arctic
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			OR = {
				is_planet_class = pc_ocean
				is_planet_class = pc_gaia
			}
		}
		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_tropical
			}
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -1
			owner = {
				OR = {
					has_civic = civic_anglers
					has_civic = civic_corporate_anglers
				}
			}
		}

		modifier = {
			add = -1
			owner = { has_trait = trait_aquatic	}
			is_homeworld = yes
		}

		modifier = {
			add = -0.5
			colony_type = col_research
		}
	}
}

d_tbm_impact_crater = {
	icon = d_crater
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 180

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 500
			minerals = 500
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_mining_max = 1
		planet_miners_minerals_produces_mult = 0.05	
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 2		
		}
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 2
			has_planet_modifier = pm_asteroid_belt			
		}
		modifier = {
			factor = 2
			has_planet_modifier = pm_asteroid_impacts
		}
		modifier = {
			factor = 2
			has_planet_modifier = pm_high_gravity
		}
		modifier = {
			factor = 1.5
			has_ring = yes
		}
		modifier = {
			factor = 1.5
			has_moon = yes
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.75
			colony_type = col_mining
		}

		modifier = {
			add = -0.5
			owner = { has_trait = trait_lithoid }
		}
	}
}

d_frozen_wasteland = {
	category = deposit_cat_energy
	
	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	can_be_cleared = {
		owner = {
			OR = {
				has_technology = tech_housing_2
				has_technology = tech_terrestrial_sculpting
			}
		}
	}

	time = 7200

	resources = {
		category = deposit_blockers_natural
		produces = {
			trigger = {
				has_planet_flag = desert_strong
			}
			unity = 1
		}
		cost = {
			energy = 1800
		}
	}
	
	on_cleared = {
		owner = {
			add_resource = {
				minerals = 200
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -3
		district_generator_max = 1
		planet_buildings_cost_mult = 0.2
		pop_happiness = -0.1
	}

	potential = {
		OR = {
			is_cold = yes
			is_planet_class = pc_nuked
		}
	}

	drop_weight = {
		weight = @very_low
		
		modifier = {
			factor = 4
			planet_size > 20
		}
		modifier = {
			factor = 2
			planet_size > 15
		}
		modifier = {
			factor = 0.5
			planet_size < 13
		}
		
		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_tundra
				is_planet_class = pc_arctic
			}
		}
		modifier = {
			factor = 4
			is_planet_class = pc_nuked
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -0.25 	# Slight boost, but this is still a space killer, so we want to clear it soon even on generator worlds.
			colony_type = col_generator
		}

		modifier = {
			add = -2 	# However, keep it if we're on a generator world and we're trying to build more generators
			colony_type = col_generator
			num_free_districts = {
				type = district_generator
				value < 1
			}
		}
	}
}

d_mountain_jungle = {
	#icon = d_old_mountain
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 900

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 1000
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
				food = 200
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		planet_amenities_add = 5
		planet_researchers_society_research_produces_mult = 0.1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_spiritualist = yes }
		}
		modifier = {
			planet_priests_unity_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 2
			planet_colonist_food_produces_add = 1
		}
	}

	potential = {
		OR = {
			is_planet_class = pc_alpine
			is_planet_class = pc_ocean
			is_planet_class = pc_continental
			is_planet_class = pc_arid
			is_planet_class = pc_gaia
			is_planet_class = pc_nuked
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			planet_size > 20
		}
		modifier = {
			factor = 2
			planet_size > 15
		}
		modifier = {
			factor = 0.5
			planet_size < 13
		}

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_gaia
				is_planet_class = pc_alpine
			}
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_arid
		}
		modifier = {
			factor = 0.1
			is_planet_class = pc_nuked
		}

		modifier = {
			factor = 5
			has_planet_modifier = pm_lush
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = 1
			owner = {
				has_ai_personality = hegemonic_imperialists	# We like imposing landscape
				has_ai_personality = spiritual_seekers	#Jungle visions
				has_ai_personality = migrating_flock	# Conveniently located
				has_ai_personality = erudite_explorers	# Save the trees
				has_ai_personality = federation_builders
			}
		}

		modifier = {
			add = -0.75	# Keep it around for research.
			any_owned_pop = {
				has_job = colonist
			}
			NOT = { colony_type = col_default }
		}

		modifier = {
			add = -0.75
			OR = {
				colony_type = col_research
				colony_type = col_bureau_spiritualist
			}
		}

		modifier = {
			add = -2.5	# These are good for priests
			owner = {
				is_spiritualist = yes
				num_assigned_jobs = {
					job = priest
					value > 1
				}
			}
		}
	}
}

d_taiga = {
	icon = d_old_infestation
	category = deposit_cat_food
	
	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 800

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 800
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 200
				food = 200
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		planet_jobs_food_produces_mult = 0.05
		pop_happiness = -0.05
	}

	triggered_planet_modifier = {
		potential = {
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_food_produces_add = 2
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			planet_size > 20
		}
		modifier = {
			factor = 2
			planet_size > 15
		}
		modifier = {
			factor = 0.5
			planet_size < 13
		}

		modifier = {
			factor = 2
			is_planet_class = pc_tundra
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_gaia
				is_planet_class = pc_arctic
			}
		}
		modifier = {
			factor = 0.1
			OR = {
				is_planet_class = pc_nuked
				is_planet_class = pc_tropical
				is_planet_class = pc_ocean
				is_dry = yes
			}
		}

		modifier = {
			factor = 5
			has_planet_modifier = pm_lush
		}
		modifier = {
			factor = 2
			has_deposit = d_rugged_woods
		}
	}

	ai_weight = {
		weight = @clear	# These are space-killers with very marginal benefits.

		modifier = {
			add = -1	# Will stick around on farm worlds until space is needed.
			colony_type = col_farming
		}

		modifier = {
			add = -1
			any_owned_pop = {
				has_job = colonist
			}
		}

		modifier = {
			add = -1
			colony_type = col_default
		}

		modifier = {
			add = -0.5
			owner = {
				has_ai_personality = migrating_flock
				has_ai_personality = hegemonic_imperialists	# Dark and brooding
			}
		}

		modifier = {
			add = -1000
			owner = {
				has_ai_personality = metalhead	# Space Finland
			}
		}
	}
}

d_scrubland = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 360

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 400
		}
	}
	
	on_cleared = {
		owner = {
			add_resource = {
				minerals = 200
				food = 200
			}
		}
	}
	planet_modifier = {
		planet_max_districts_add = -2
		planet_jobs_food_produces_mult = 0.05
		pop_housing_usage_mult = -0.05
	}

	triggered_planet_modifier = {
		potential = {
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_food_produces_add = 2
		}
	}

	potential = {
		OR = {
			is_dry = yes
			is_planet_class = pc_continental
			is_planet_class = pc_gaia
			is_planet_class = pc_nuked
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			planet_size > 20
		}
		modifier = {
			factor = 2
			planet_size > 15
		}
		modifier = {
			factor = 0.5
			planet_size < 13
		}

		modifier = {
			factor = 4
			is_planet_class = pc_savannah
		}
		modifier = {
			factor = 2
			is_planet_class = pc_gaia
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_desert
		}
		modifier = {
			factor = 0.1
			is_planet_class = pc_nuked
		}

		modifier = {
			factor = 5
			has_planet_modifier = pm_lush
		}
	}

	ai_weight = {
		weight = @clear	# These are space-killers with very marginal benefits.

		modifier = {
			add = -1	# Will stick around on farm worlds until space is needed.
			colony_type = col_farming
		}

		modifier = {
			add = -1
			any_owned_pop = {
				has_job = colonist
			}
		}

		modifier = {
			add = -1
			colony_type = col_default
		}
	}
}

# Disable for Phase 1
# d_great_valley = {
		
# 	is_for_colonizable = yes
# 	use_for_min_max_adjustments = yes

# 	category = deposit_category_gaia

# 	use_weights_for_terraforming_swap_types = yes
# 	should_swap_deposit_on_terraforming = yes

# 	icon = d_wide_valley

# 	planet_modifier = {
# 		district_farming_max = 2
# 		planet_farmers_food_produces_mult = 0.1
# 	}

# 	drop_weight = {
# 		weight = @very_low

# 		modifier = {
# 			add = 40
# 			is_planet_class = pc_gaia
# 		}
# 	}
# }

# Disabled for Phase 1
# d_wide_valley = {
		
# 	is_for_colonizable = yes
# 	use_for_min_max_adjustments = yes

# 	category = deposit_category_gaia

# 	use_weights_for_terraforming_swap_types = yes
# 	should_swap_deposit_on_terraforming = yes

# 	planet_modifier = {
# 		district_farming_max = 1
# 	}

# 	drop_weight = {
# 		weight = @med

# 		modifier = {
# 			factor = 0.25
# 			OR = {
# 				is_planet_class = pc_arid
# 				is_planet_class = pc_arctic
# 				is_planet_class = pc_tropical
# 				is_planet_class = pc_tundra
# 			}
# 		}
# 		modifier = {
# 			factor = 0
# 			OR = {
# 				is_planet_class = pc_ocean
# 				is_planet_class = pc_desert
# 			}
# 		}

# 		modifier = {
# 			factor = 2
# 			has_deposit = d_great_river
# 		}
# 	}
# }

d_barren = {
	category = deposit_cat_blockers_natural
	
	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 720

	prerequisites = {
		"tech_quicksand_basin"
	}

	on_cleared = {
		custom_tooltip = tooltip_clear_barren
		hidden_effect = {
			add_from_barren = yes
		}
	}

	planet_modifier = {
		planet_farmers_food_produces_mult = -0.1
		planet_miners_minerals_produces_mult = -0.1
		planet_amenities_mult = -0.05
	}

	drop_weight = {
		weight = @med
	}

	ai_weight = {
		weight = @always_clear
	}
}

d_fertile_delta = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	prerequisites = {
		"tech_terrestrial_sculpting"
	}

	time = 1500

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 2000
		}
	}

	on_cleared = {
		add_deposit = d_great_river_obstructed
		hidden_effect = {
			add_deposit = d_tidal_marshes
			add_deposit = d_floodplains
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		planet_jobs_food_produces_mult = 0.05
		district_farming_max = 1
		district_generator_max = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_physics_research_produces_add = 2
		}
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_tundra
				is_planet_class = pc_savannah
			}
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_arctic
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_alpine
				is_planet_class = pc_nuked
			}
		}
		
		modifier = {
			factor = 5
			has_deposit = d_great_river
		}
	}

	ai_weight = {
		weight = @keep

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = 1		# Keep unless industrial/urban, in which case keep until we need a district as it's still a good feature and clearing it has downsides.
			NOR = {
				colony_type = col_rural
				colony_type = col_farming
				colony_type = col_mining
				colony_type = col_generator
				num_assigned_jobs = {
					job = farmer
					value > 2
				}
			}
		}
	}
}

d_drylands = {
	category = deposit_cat_energy

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 720

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 600
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_generator_max = 1
		planet_farmers_food_produces_mult = -0.05
		planet_miners_minerals_produces_mult = 0.05
	}

	drop_weight = {
		weight = @high

		modifier = {
			factor = 2
			is_dry = yes
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_ocean
				is_planet_class = pc_alpine
				is_planet_class = pc_tropical
			}
		}
	}

	ai_weight = {
		weight = @keep

		modifier = {
			add = 1
			NOR = {
				colony_type = col_rural
				colony_type = col_generator
				colony_type = col_farming
			}
		}

		modifier = {
			add = -0.75
			owner = { has_civic = civic_agrarian_idyll }
		}
	}
}

d_crags = {
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	prerequisites = {
			"tech_terrestrial_sculpting"
		}

		time = 720

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 800
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 200
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		planet_miners_minerals_produces_mult = 0.05
		planet_amenities_add = 5
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_minerals_produces_add = 2
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 5
			is_planet_class = pc_alpine
		}
		modifier = {
			factor =2
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_ocean
				is_planet_class = pc_arctic
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_arid
				is_planet_class = pc_desert
			}
		}
	}

	ai_weight = {
		weight = @keep

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = 1
			NOR = {
				colony_type = col_mining
				free_amenities < 5
			}
		}

		modifier = {
			add = -0.75
			owner = { has_ai_personality = migrating_flock }
		}
	}
}

d_dunelands = {
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	can_be_cleared = {
		owner = {
			OR = {
				has_technology = tech_noxious_swamp
				has_technology = tech_terrestrial_sculpting
			}
		}
	}

	time = 1080

	resources = {
		category = deposit_blockers_natural
		cost = {
			trigger = {
				owner = { has_technology = tech_terrestrial_sculpting }
			}
			energy = 775
		}
		cost = {
			trigger = {
				owner = { NOT = { has_technology = tech_terrestrial_sculpting }}
			}
			energy = 1500
			minerals = 600
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		planet_farmers_food_produces_mult = -0.1
		planet_technician_energy_produces_mult = 0.05
		planet_jobs_upkeep_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 2
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			is_planet_class = pc_desert
		}
		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_savannah
				is_planet_class = pc_arid
				is_planet_class = pc_ocean
			}
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_tropical
				is_cold = yes
			}
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1	# Keep until space needed on generator, otherwise not worth the upkeep.
			colony_type = col_generator
		}

		modifier = {
			add = -1
			OR = {
				any_owned_pop = {
					has_job = colonist
				}
				colony_type = col_default
			}
		}
	}
}

d_highland_lake = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 720

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 720
			minerals = 400
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
		planet_amenities_add = 5
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			is_planet_class = pc_alpine
		}
		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_gaia
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_arid
				is_planet_class = pc_ocean
				is_planet_class = pc_savannah
				is_planet_class = pc_tropical
			}
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_arctic
				is_planet_class = pc_desert
				is_planet_class = pc_nuked
			}
		}

		modifier = {
			factor = 2
			OR = {
				has_deposit = d_mountain_range
				has_deposit = d_highlands
				has_deposit = d_steppe_uplands
			}
		}
	}

	ai_weight = {
		weight = @keep

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = 1		# Keep unless industrial/urban, in which case keep until we need a district as it's still a good feature and clearing it has downsides.
			OR = {
				colony_type = col_industrial
				colony_type = col_foundry
				colony_type = col_factory
				colony_type = col_city
				num_assigned_jobs = {
					job = farmer
					value < 3
				}
			}
		}
	}
}

d_lakelands = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	can_be_cleared = {
		owner = {
			OR = {
				has_technology = tech_terrestrial_sculpting
				has_technology = tech_mountain_range
			}
		}
	}

	time = 1080

	resources = {
		category = deposit_blockers_natural
		cost = {
			trigger = {
				owner = { has_technology = tech_terrestrial_sculpting }
			}
			energy = 800
		}
		cost = {
			trigger = {
				owner = { NOT = { has_technology = tech_terrestrial_sculpting }}
			}
			energy = 1200
			minerals = 500
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		district_farming_max = 1
		planet_amenities_mult = 0.1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 2
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 2
			is_planet_class = pc_continental
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_alpine
		}
		modifier = {
			factor = 0
			OR = {
				is_dry = yes
				is_planet_class = pc_arctic
				is_planet_class = pc_nuked
			}
		}
	}

	ai_weight = {
		weight = @keep

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = 1		# Keep unless industrial/urban, in which case keep until we need a district as it's still a good feature and clearing it has downsides.
			OR = {
				colony_type = col_industrial
				colony_type = col_foundry
				colony_type = col_factory
				colony_type = col_city
				num_assigned_jobs = {
					job = farmer
					value < 3
				}
			}
		}

		modifier = {
			add = 0.75
			owner = { has_ai_personality = ruthless_capitalists }	# Can we pollute this somehow?
		}
	}
}

d_lowland_hills = {
	category = deposit_cat_blockers_natural

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 1080

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 500
		}
	}

	prerequisites = {
		"tech_mountain_range"
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		district_farming_max = 1
		planet_miners_minerals_produces_mult = 0.05
	}

	drop_weight = {
		weight = @high

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_continental
				is_planet_class = pc_tundra
				is_planet_class = pc_alpine
				is_planet_class = pc_arid
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_desert
				is_planet_class = pc_arctic
			}
		}
		modifier = {
			factor = 0
			is_planet_class = pc_nuked
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.5
			OR = {
				colony_type = col_farming
				colony_type = col_mining
			}
		}
	}
}

d_misty_plains = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 720

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 500
		}
	}

	prerequisites = {
		"tech_terrestrial_sculpting"
	}

	planet_modifier = {
		pop_happiness = -0.05
		planet_farmers_food_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner	
			owner = { has_trait = trait_plantoid_phototrophic }
		}
		modifier = {
			planet_pops_organics_energy_upkeep_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 2
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			OR = {
				is_planet_class = pc_tundra
				is_wet = yes
			}
		}
		modifier = {
			factor = 2
			is_planet_class = pc_nuked
		}
		modifier = {
			factor = 0.5
			is_dry = yes
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -0.5
			colony_type = col_farming
		}

		modifier = {
			add = -100
			is_planet_class = pc_nuked	# Mostly for flavor, but can also be more useful for the food on tombs
		}
	}
}

d_salt_flats = {
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	prerequisites = {
			"tech_mountain_range"
		}

		time = 1080

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 1000
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
				engineering_research = 500
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_mining_max = 1
		planet_miners_minerals_produces_mult = 0.15
		pop_happiness = -0.15
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 2
			planet_colonist_physics_research_produces_add = 1
		}
	}

	drop_weight = {
		weight = @blocker_low

		modifier = {
			factor = 2
			OR = {
				is_planet_class = pc_ocean
				is_dry = yes
			}
		}
		modifier = {
			factor = 0
			is_planet_class = pc_tropical
		}
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1.5
			colony_type = col_mining
		}

		modifier = {
			add = -0.5
			owner = {
				has_ai_personality = hegemonic_imperialists	# Minerals matter more
				has_ai_personality = ruthless_capitalists	# Easy profits
				has_ai_personality = slaving_despots	# Workin' the salt mines
				has_ai_personality = harmonious_hierarchy
				has_ai_personality = spiritual_seekers	# Water from salt
				has_ai_personality = evangelising_zealots
			}
		}
	}
}

d_arid_plains = {
	category = deposit_cat_energy

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 1080

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 500
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_generator_max = 1
		planet_buildings_upkeep_mult = 0.2
	}

	triggered_planet_modifier = {
		potential = {
			owner.home_planet = {
				is_dry = yes
			}
		}
		modifier = {
			planet_max_districts_add = 1
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 2
			is_dry = yes
		}
		modifier = {
			factor = 0.5
			is_planet_class = pc_ocean
		}
		modifier = {
			factor = 0
			OR = {
				is_planet_class = pc_tropical
				is_cold = yes
			}
		}
	}

	ai_weight = {
		weight = @clear

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -1000	# Free district for dry species
			owner.home_planet = {
				is_dry = yes
			}
		}

		modifier = {
			add = -1
			colony_type = col_generator
		}
	}
}

d_sandsea = {
	category = deposit_cat_rare_blocker

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	can_be_cleared = {
		owner = {
			OR = {
				has_technology = tech_terrestrial_sculpting
				has_technology = tech_mountain_range
			}
		}
	}

	time = 2500

	resources = {
		category = deposit_blockers_natural
		cost = {
			trigger = {
				owner = { has_technology = tech_terrestrial_sculpting }
			}
			energy = 2000
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -3
		district_generator_max = 2
		planet_jobs_minerals_produces_mult = -0.1
	}

	triggered_planet_modifier = {
		potential = {
			# Yes, you need both to live under the sand.
			exists = owner
			owner_main_species = { has_trait = trait_aquatic }
			owner.home_planet = { is_dry = yes }
		}
		modifier = {
			planet_max_districts_add = 3
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 4
			planet_colonist_physics_research_produces_add = 4
		}
	}

	potential = {
		OR = {
			is_dry = yes
			is_planet_class = pc_tundra
		}
	}

	drop_weight = {
		weight = @very_low

		modifier = {
			factor = 4
			is_planet_class = pc_desert
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_arid
				is_planet_class = pc_savannah
				is_planet_class = pc_tundra
			}
		}
	}

	ai_weight = {
		weight = @always_clear

		modifier = {
			add = -1000	# Only if you can live under the sand (I don't think the AI can take this in vanilla, but for custom empires)
			owner_main_species = { has_trait = trait_aquatic }
			owner.home_planet = { is_dry = yes }
		}
	}
}

d_sandstone_cliffs = {
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 270

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 500
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
				engineering_research = 100
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_mining_max = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_engineering_research_produces_add = 1
		}
	}

	potential = {
		NOT = { is_planet_class = pc_arctic }
	}

	drop_weight = {
		weight = @high
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.75
			colony_type = col_mining
		}

		modifier = {
			add = -0.5
			owner = {
				OR = {
					has_civic = civic_mining_guilds
					has_ai_personality = slaving_despots
					has_ai_personality = harmonious_hierarchy
					has_ai_personality = ruthless_capitalists
				}
			}
		}
	}
}

d_highlands = {
	category = deposit_cat_minerals

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no
	
	prerequisites = {
		"tech_terrestrial_sculpting"
	}
	
	time = 720

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 800
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -2
		district_mining_max = 1
		planet_amenities_mult = 0.05
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 2
			is_planet_class = pc_alpine
		}
		modifier = {
			factor = 2
			is_cold = yes
		}
		modifier = {
			factor = 0.5
			OR = {
				is_planet_class = pc_tropical
				is_planet_class = pc_savannah
				is_planet_class = pc_desert
				is_planet_class = pc_nuked
			}
		}
	}

	ai_weight = {
		weight = @clear

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -2.25
			colony_type = col_mining
		}

		modifier = {
			add = 0.25
			free_district_slots < 2
		}

		modifier = {
			add = -0.5
			free_amenities < 5
		}
	}
}

d_rough_plains = {
	category = deposit_cat_food

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 90

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 400
		}
	}

	on_cleared = {
		hidden_effect = {
			random_list = {
				20 = {
					modifier = {
						factor = 2
						owner = { has_technology = tech_mountain_range }
					}
	
					add_deposit = d_bountiful_plains
				}
				80 = {}
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
		planet_farmers_food_produces_mult = -0.05
		planet_amenities_mult = -0.05
	}

	drop_weight = {
		weight = @high
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = 1	# Clear unless you really need the farming space AND have the amenities covered
			colony_type = col_farming
			num_districts = {
				type = district_farming
				value < 3
			}
			num_free_districts = {
				type = district_farming
				value < 1
			}
			free_amenities > 10
		}
	}
}

d_seaweed_shoals = {
	icon = d_boggy_fens
	category = deposit_cat_blockers_natural

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 180

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 400
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				food = 100
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
		# Let's add some ecological benefits here.
		# Consider having some pre-sapients living int he seaweed.
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_trait = trait_aquatic }
		}
		modifier = {
			planet_max_districts_add = -1
			district_farming_max = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			owner = {
				exists = owner
				any_owned_pop = {
					has_job = colonist
				}
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 1
		}
	}

	potential = {
		OR = {
			is_wet = yes
			is_planet_class = pc_gaia
		}
	}

	drop_weight = {
		weight = @med

		modifier = {
			factor = 4
			is_planet_class = pc_ocean
		}
	}

	ai_weight = {
		weight = @base

		inline_script = tbm_personality_weights
		inline_script = tbm_designation_weights

		modifier = {
			add = -0.5
			colony_type = col_farming
		}

		modifier = {
			add = -0.5	# Keep for sure if aquatic farm world.
			colony_type = col_farming
			owner = { has_trait = trait_aquatic }
		}
	}
}

d_gas_vents = {
	category = deposit_cat_energy

	use_for_min_max_adjustments = yes
	should_swap_deposit_on_terraforming = no

	prerequisites = {
		"tech_volcano"
	}

	time = 480

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 800
			minerals = 400
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				exotic_gases = 50
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_generator_max = 1
		planet_researchers_engineering_research_produces_mult = 0.05
	}

	drop_weight = {
		weight = @low

		modifier = {
			factor = 2
			is_cold = yes
		}

		modifier = {
			factor = 4
			is_planet_class = pc_gaia
		}

		modifier = {
			factor = 1.5
			has_volcanic_activity = yes
		}
	}

	ai_weight = {
		weight = @keep

		modifier = {
			add = -0.5
			colony_type = col_generator
		}
	}
}


### TBM Custom Features - Artificial (these are mostly added by events or by other features)


# Sprawling Slums - Modified but does not overwrite vanilla for compat purposes
d_tbm_slums = {
	icon = d_slums
	category = deposit_cat_blockers

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 180

	resources = {
		category = deposit_blockers
		cost = {
			energy = 300
		}
	}
		
	on_cleared = {
		create_pop = {
			species = owner
		}
	}


	planet_modifier = {
		planet_max_districts_add = -1
		planet_researchers_society_research_produces_add = 1
		
		### Reduces amenities but also amenities usage; you'll get more of these on big worlds with lots of worker pops. At large populations, the percentage will outweigh the flat hit.
		### Egalitarian empires will struggle with the happiness penalties, but slums may be a useful buff for some ethic types (e.g., Authoritarian).
		planet_amenities_add = -5
		pop_amenities_usage_mult = -0.05
		pop_cat_worker_happiness = -0.05
		planet_crime_mult = 0.05
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -0.25
			owner = {
				OR = {
					has_ai_personality = hegemonic_imperialists
					has_ai_personality = ruthless_capitalists
					has_ai_personality = slaving_despots
				}
			}
		}

		modifier = {
			add = -0.5
			owner = { is_authoritarian = yes }
			num_pops > 40
		}
	}
}

# Crater - Modified but does not overwrite vanilla for compat purposes
d_tbm_crater = {
	icon = d_crater
	category = deposit_cat_blockers

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 480

	resources = {
		category = deposit_blockers
		cost = {
			energy = 300
			minerals = 200
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_mining_max = 1
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @always_clear
	}
}


# Failing Infrastructure are generated on homeworlds at game-start
# Additions from The Blocker Mod, and can be added via event - will not apply on homeworlds.
d_tbm_industrial_wasteland = {
	icon = d_metal_boneyard
	category = deposit_cat_blockers

	is_for_colonizable = yes
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 270

	resources = {
		category = deposit_blockers
		cost = {
			energy = 800
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		pop_happiness = -0.05
		
		trade_value_mult = 0.02
		planet_crime_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			any_owned_pop = {
				has_job = researcher
			}
		}
		modifier = {
			planet_researchers_engineering_research_produces_add = 1
		}
	}

	potential = { always = no }

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1	# Keep until a district is needed so long as there's a researcher.
			any_owned_pop = {
				has_job = researcher	
			}
		}
	}
}

d_rubble = {
	icon = d_rubble
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 180

	planet_modifier = {
		planet_amenities_add = -2
		planet_max_districts_add = -1
		district_mining_max = 1		# Allows rubble to be situationally useful for mining.
		planet_miners_minerals_produces_mult = -0.05	# This is to disincentivize stacking these for mining super-planets.
	}

	resources = {
		category = deposit_blockers
		cost = { 
			energy = 400
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 100
				unity = 10
			}
		}
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @clear
	}
}

d_collapsed_cliffs = {
	icon = d_veiny_cliffs
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 720

	resources = {
		category = deposit_blockers
		cost = {
			energy = 500
		}
		produces = {
			minerals = 800
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_mining_max = 1
		planet_amenities_add = -10
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 500
			}
		}
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1.5
			colony_type = col_mining
		}
	}
}

d_great_river_obstructed = {
	icon = d_great_river
	category = deposit_category_final

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	# on_cleared = {
	# 	add_deposit = d_great_river
	# 	# Flooding Caused
	# 	hidden_effect = {
	# 		random_list = {
	# 			33 = {
	# 				planet_event = {
	# 					id = tbm.27
	# 					days = 30
	# 				}
	# 			}
	# 			33 = {
	# 				modifier = {
	# 					factor = 2
	# 					num_districts = {
	# 						type = any
	# 						value > 9
	# 					}
	# 				}
	# 				planet_event = {
	# 					id = tbm.28
	# 					days = 30
	# 				}
	# 			}
	# 			33 = {
	# 				planet_event = {
	# 					id = tbm.29
	# 					days = 30
	# 				}
	# 			}
	# 		}
	# 	}
	# }

	planet_modifier = {
		planet_farmers_food_produces_mult = 0.1
	}

	potential = {
		always = no
	}

	# ai_weight = {
	# 	weight = @always_keep
	# }
}

d_urban_power_plant = {
	icon = d_reactor
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 270

	resources = {
		category = deposit_blockers
		cost = {
			energy = 1000
			engineering_research = 100
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_generator_max = 1
		planet_technician_energy_produces_add = 1
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @base

		modifier = {
			add = 5	# Keep, but only on generator worlds where we're actually getting some benefit.
			colony_type = col_generator
			num_assigned_jobs = {
				job = technician
				value > 4
			}
		}

		modifier = {
			add = 100	# Keep around if empire needs the energy
			owner = {
				resource_income_compare = {
					resource = energy
					value < 10
				}
			}
		}
	}
}

d_geothermal_power_plant = {
	icon = d_bunker_door
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 270

	resources = {
		category = deposit_blockers
		cost = {
			energy = 500
		}
	}

	planet_modifier = {
		district_generator_max = 1
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @always_keep
	}
}

d_hydro_plant = {
	icon = d_ruins_medium
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 480

	resources = {
		category = deposit_blockers
		cost = {
			energy = 800
		}
	}

	planet_modifier = {
		district_generator_max = 1
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @always_keep
	}
}

d_dyke = {
	icon = d_natural_farmland
	category = deposit_category_final

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	#time = 180
	
	# resources = {
	# 	category = deposit_blockers_natural
	# 	cost = {
	# 		energy = 500
	# 	}
	# }

	planet_modifier = {
		pop_housing_usage_mult = 0.02
	}

	potential = {
		always = no
	}
}

d_settlement = {

	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes
	
	should_swap_deposit_on_terraforming = yes

	time = 360

	resources = {
		category = deposit_blockers
		produces = {
			unity = -1
		}
		cost = {
			energy = 200
			consumer_goods = 50
		}
	}

	planet_modifier = {
		planet_housing_add = 3
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @base
	}
}

d_frontier_farmstead = {
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = yes

	time = 360

	resources = {
		category = deposit_blockers
		cost = {
			energy = 200
			consumer_goods = 50
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
		district_farming_max = 1
		planet_farmers_unity_upkeep_add = -0.25
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { has_civic = civic_agrarian_idyll }
		}
		planet_farmers_unity_produces_add = 0.5
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @base

		modifier = {
			add = -1	# Should lead to agrarians having smaller, less developed worlds with lots of farm districts and lots of frontier homesteads for conquerors to pillage
			owner = { has_civic = civic_agrarian_idyll }
		}
	}
}

d_dustbowl = {
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	blocker_swap_types = {
		d_reclaimed_land
	}

	time = 1080

	resources = {
		category = deposit_blockers
		cost = {
			energy = 500
			minerals = 100
		}
	}

	planet_modifier = {
		district_mining_max = 1
		planet_farmers_food_produces_mult = -0.2
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -2
			colony_type = col_mining
			num_free_districts = {
				type = district_mining
				value < 1
			}
		}
	}
}

d_moisture_farms = {

	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 480

	resources = {
		category = deposit_blockers
		cost = {
			energy = 300
			consumer_goods = 40
		}
	}

	planet_modifier = {
		district_farming_max = 1
	}

	ai_weight = {
		weight = @keep
	}
}

d_black_market = {
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 180

	resources = {
		category = deposit_blockers
		cost = {
			energy = 400
			food = 200
			unity = 100
		}
	}

	planet_modifier = {
		trade_value_mult = 0.10
		planet_crime_add = 10
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @clear

		modifier = {
			add = -1
			owner = {
				has_ai_personality = ruthless_capitalists	# Market economy
				has_ai_personality = hegemonic_imperialists	# We don't really care
				has_ai_personality = slaving_despots
			}
		}
	}
}

d_collapsed_tunnel = {
	category = deposit_cat_blockers

	potential = {
		always = no
	}
}


### TBM Event Features

d_ruler_mountain = {	
	icon = d_mountain_range
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 950

	resources = {
		category = deposit_blockers
		cost = { 
			energy = 2000
		}
		produces = {
			unity = 10
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 2000
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -3
		district_mining_max = 2
		planet_miners_minerals_produces_mult = 0.1
		planet_amenities_add = 2
	}

	### Note that this flag behaves differently on the special mountains
	triggered_planet_modifier = {
		potential = {
			this = { has_deposit_flag = mineral_rights }
		}
		modifier = {
			district_mining_max = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			this = { has_deposit_flag = mining_prohibited }
		}
		modifier = {
			district_mining_max = -1
			planet_administrators_unity_produces_mult = 0.05
		}
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}
}

d_homeworld_mountain = {
	icon = d_mountain_range
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 950

	resources = {
		category = deposit_blockers
		cost = { 
			energy = 2000
		}
		produces = {
			unity = 10
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 2000
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -3
		district_mining_max = 2
		planet_miners_minerals_produces_mult = 0.1
		planet_amenities_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			this = { has_deposit_flag = mineral_rights }
		}
		modifier = {
			district_mining_max = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			this = { has_deposit_flag = mining_prohibited }
		}
		modifier = {
			district_mining_max = -1
			planet_administrators_unity_produces_mult = 0.05
		}
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}
}

d_colonist_mountain = {
	icon = d_mountain_range
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 950

	resources = {
		category = deposit_blockers
		cost = { 
			energy = 2000
		}
		produces = {
			unity = 10
		}
	}

	on_cleared = {
		owner = {
			add_resource = {
				minerals = 2000
			}
		}
	}

	planet_modifier = {
		planet_max_districts_add = -3
		district_mining_max = 2
		planet_miners_minerals_produces_mult = 0.1
		planet_amenities_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			this = { has_deposit_flag = mineral_rights }
		}
		modifier = {
			district_mining_max = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			this = { has_deposit_flag = mining_prohibited }
		}
		modifier = {
			district_mining_max = -1
			planet_administrators_unity_produces_mult = 0.05
		}
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}
}

d_great_desert = {
	icon = d_searing_desert
	category = deposit_cat_artificial

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no
	
	planet_modifier = {
		planet_max_districts_add = -2
		district_farming_max = 3
		district_generator_max = 1
		planet_jobs_unity_produces_mult = 0.10
		planet_jobs_energy_produces_mult = 0.05
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}
}

d_great_city = {
	icon = d_searing_desert
	category = deposit_cat_artificial
	
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	planet_modifier = {
		pop_job_amenities_mult = 0.2
		pop_housing_usage_mult = -0.1
		planet_jobs_upkeep_mult = -0.1
		planet_jobs_energy_produces_mult = 0.05
		district_generator_max = 1
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}
}

d_submerged_zro_seam = {
	icon = d_submerged_ore_veins
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	time = 4800

	resources = {
		category = deposit_blockers_natural
		cost = {
			energy = 1800
		}
		produces = {
			trigger = {
				NOT = { has_planet_flag = inaccessible_zro }
			}
			sr_zro = 2
		}
	}

	on_cleared = {
		hidden_effect = {
			if = {
				limit = {
					has_planet_flag = inaccessible_zro
				}
				random_list = {
					50 = {
						owner = {
							add_resource = {
								sr_zro = 500
							}
						}
					}
					50 = {}
				}
			}
		}
	}

	planet_modifier = {
		district_mining_max = 2
	}

	triggered_planet_modifier = {
		potential = {
			any_owned_pop = {
				has_job = colonist
			}
		}
		modifier = {
			planet_colonist_society_research_produces_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			has_planet_flag = zro_fish
		}
		modifier = {
			planet_miners_minerals_produces_mult = -0.2
		}
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}	
}

d_prototype_gas_generator = {
	icon = d_submerged_ore_veins
	category = deposit_cat_artificial
	
	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	resources = {
		category = deposit_blockers
		produces = {
			energy = 5
		}
	}

	planet_modifier = {
		planet_amenities_add = -5
	}

	potential = { always = no }

	ai_weight = {
		weight = @keep
	}
}

d_private_farming_colony = {
	icon = d_frontier_farmstead
	category = deposit_cat_blockers

	use_for_min_max_adjustments = yes

	should_swap_deposit_on_terraforming = no

	resources = {
		category = deposit_blockers
		produces = {
			energy = 2
		}
		cost = {
			energy = 800
			consumer_goods = 200
		}
	}

	planet_modifier = {
		planet_max_districts_add = -1
	}

	potential = {
		always = no
	}

	ai_weight = {
		weight = @always_clear
	}
}